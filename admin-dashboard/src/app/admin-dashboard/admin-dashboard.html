<div class="dashboard">
  <!-- Sidebar -->
  <div class="sidebar">
    <button (click)="selectedTab='view'">📋 View Students</button>
    <button (click)="prepareAddStudent()">➕ Add Student</button>
    <button (click)="selectedTab='departments'">🏢 View Departments</button>
  </div>

  <!-- Main Content -->
  <div class="content">

    <!-- ----------------- VIEW STUDENTS ----------------- -->
    <div *ngIf="selectedTab === 'view'">
      <h2>All Students</h2>

      <!-- Department Filter -->
      <label>Filter by Department: 
        <select [(ngModel)]="filterDept" (change)="loadStudents()">
          <option value="">All</option>
          <option value="CSE">CSE</option>
          <option value="ECE">ECE</option>
          <option value="ME">ME</option>
          <option value="CIV">CIV</option>
          <option value="IT">IT</option>
        </select>
      </label>

      <table border="1" cellpadding="5">
        <tr>
          <th>Name</th>
          <th>Roll</th>
          <th>Department</th>
          <th>Semester</th>
          <th>Actions</th>
        </tr>
        <tr *ngFor="let s of students">
          <td>{{s.name}}</td>
          <td>{{s.roll}}</td>
          <td>{{s.department}}</td>
          <td>{{s.semester}}</td>
          <td>
            <button (click)="openEditInfo(s)">✏️ Edit Info</button>
            <button (click)="openEditMarks(s)">📝 Edit Marks</button>
            <button (click)="openResults(s)">📊 View Result</button>
            <button (click)="deleteStudent(s)">❌ Delete</button>
          </td>
        </tr>
      </table>
    </div>

    <!-- Add Student -->
<div *ngIf="selectedTab === 'add'">
  <h2>Add Student</h2>
  <form (ngSubmit)="addStudent()">
    <label>Name:</label>
    <input [(ngModel)]="newStudent.name" name="name" required>
    <label>Department:</label>
    <select [(ngModel)]="newStudent.department" name="department" required>
      <option *ngFor="let d of departments" [value]="d.code">{{ d.name }}</option>
    </select>
    <button type="submit">Add</button>
    <button type="button" (click)="cancel()">Cancel</button>
  </form>
</div>

<!-- Edit Student Info -->
<div *ngIf="selectedTab === 'editInfo'">
  <h2>Edit Student Info</h2>
  <form (ngSubmit)="saveStudentInfo()">
    <label>Name:</label>
    <input [(ngModel)]="editInfoStudent.name" name="name" required>
    <label>Department:</label>
    <input [(ngModel)]="editInfoStudent.department" name="department" required>
    <button type="submit">Save</button>
    <button type="button" (click)="cancel()">Cancel</button>
  </form>
</div>

<!-- Edit Marks -->
<div *ngIf="selectedTab === 'editMarks'">
  <h2>Edit Marks</h2>
  <form (ngSubmit)="saveStudentMarks()">
    <div *ngFor="let subject of editResult.subjects; let i = index">
      <label>{{subject.name}}:</label>
      <input type="number" [(ngModel)]="editResult.subjects[i].marks" name="marks{{i}}">
    </div>
    <button type="submit">Save</button>
    <button type="button" (click)="cancel()">Cancel</button>
  </form>
</div>

<!-- View Results -->
<div *ngIf="selectedTab === 'results'">
  <h2>{{resultStudent?.name}} - Results</h2>
  <div *ngFor="let result of studentResults">
    <h4>Semester {{result.semester}}</h4>
    <ul>
      <li *ngFor="let s of result.subjects">
        {{s.name}}: {{s.marks}} / {{s.maxMarks}}
      </li>
    </ul>
  </div>
  <button type="button" (click)="cancel()">Back</button>
</div>


    <!-- ----------------- VIEW DEPARTMENTS ----------------- -->
    <div *ngIf="selectedTab === 'departments'">
      <h2>Departments</h2>
      <table border="1" cellpadding="5">
        <tr>
          <th>Code</th>
          <th>Name</th>
        </tr>
        <tr *ngFor="let d of departments">
          <td>{{d.code}}</td>
          <td>{{d.name}}</td>
        </tr>
      </table>
    </div>
  </div>
</div>
